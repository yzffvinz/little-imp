{"version":3,"sources":["assets/scripts/Game.js"],"names":["cc","Class","Component","properties","starPrefab","type","Prefab","btnplayPrefab","maxStarDuration","minStarDuration","starDuration","ground","Node","player","score","displayName","tooltip","scoreDisplay","Label","scoreAudio","AudioClip","onLoad","timer","groundY","y","height","start","update","dt","gameOver","startGame","director","loadScene","getComponent","startMove","stopMove","showPlayBtn","playBtn","instantiate","node","addChild","setPosition","getPlayBtnPosition","game","spawnNewStar","newStar","Math","random","getNewStarPosition","v2","randX","randY","jumpHeight","maxX","width","gainScore","string","audioEngine","playEffect"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        starPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        btnplayPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        // 星星产生后消失时间的随机范围\n        maxStarDuration: 0,\n        minStarDuration: 0,\n        starDuration: 0,\n        // 地面节点，用于确定星星生成的高度\n        ground: {\n            default: null,\n            type: cc.Node\n        },\n        // player 节点，用于获取主角弹跳的高度，和控制主角行动开关\n        player: {\n            default: null,\n            type: cc.Node\n        },\n        score: {\n            default: 0,\n            displayName: \"Score (player)\",\n            tooltip: \"The score of player\",\n        },\n\n        // score label 的引用\n        scoreDisplay: {\n            default: null,\n            type: cc.Label\n        },\n        // 跳跃音效资源\n        scoreAudio: {\n            default: null,\n            type: cc.AudioClip\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n    onLoad () {\n        // 初始化计分\n        this.score = 0;\n        this.timer = 0;\n        this.groundY = this.ground.y + this.ground.height / 2;\n    },\n\n    start () {\n    },\n\n    update (dt) {\n        // 就会调用游戏失败逻辑\n        if (this.timer > this.starDuration) {\n            this.gameOver();\n            return;\n        }\n        this.timer += dt;\n    },\n\n    startGame: function () {\n        cc.director.loadScene('game');\n        this.player.getComponent('Player').startMove();\n    },\n\n    gameOver: function () {\n        this.player.getComponent('Player').stopMove();\n        // this.player.stopAllActions(); //停止 player 节点的跳跃动作\n        this.showPlayBtn();\n    },\n\n    showPlayBtn () {\n        var playBtn = cc.instantiate(this.btnplayPrefab);\n        this.node.addChild(playBtn);\n        playBtn.setPosition(this.getPlayBtnPosition());\n        playBtn.getComponent('Btnplay').game = this;\n    },\n\n    spawnNewStar () {\n        // 使用给定的模板在场景中生成一个新节点\n        var newStar = cc.instantiate(this.starPrefab);\n\n        // star存在时间\n        this.starDuration = this.minStarDuration + Math.random() * (this.maxStarDuration - this.minStarDuration);\n        this.timer = 0;\n\n        // 将新增的节点添加到 Canvas 节点下面\n        this.node.addChild(newStar);\n        // 为星星设置一个随机位置\n        newStar.setPosition(this.getNewStarPosition());\n        newStar.getComponent('Star').game = this;\n    },\n\n    getPlayBtnPosition () {\n        return cc.v2(0, 0);\n    },\n\n    getNewStarPosition () {\n        var randX = 0;\n        // 根据地平面位置和主角跳跃高度，随机得到一个星星的 y 坐标\n        var randY = this.groundY + Math.random() * this.player.getComponent('Player').jumpHeight + 50;\n        // 根据屏幕宽度，随机得到一个星星 x 坐标\n        var maxX = this.node.width / 2;\n        randX = (Math.random() - 0.5) * 2 * maxX;\n        // 返回星星坐标\n        return cc.v2(randX, randY);\n    },\n\n    gainScore: function () {\n        this.score += 1;\n        // 更新 scoreDisplay Label 的文字\n        this.scoreDisplay.string = 'Score: ' + this.score;\n        // 添加一个回调函数，用于在动作结束时调用我们定义的其他方法\n        cc.audioEngine.playEffect(this.scoreAudio, false);\n    },\n});\n"]}