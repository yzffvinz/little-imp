{"version":3,"sources":["assets/scripts/Game.js"],"names":["cc","Class","Component","properties","starPrefab","type","Prefab","btnplayPrefab","maxStarDuration","minStarDuration","starDuration","isOver","ground","Node","player","score","displayName","tooltip","scoreDisplay","Label","scoreAudio","AudioClip","onLoad","console","log","timer","groundY","y","height","spawnNewStar","start","update","dt","gameOver","stopAllActions","getComponent","xSpeed","showPlayBtn","startGame","director","loadScene","playBtn","instantiate","node","addChild","setPosition","getPlayBtnPosition","game","newStar","Math","random","getNewStarPosition","v2","randX","randY","jumpHeight","maxX","width","gainScore","string","audioEngine","playEffect"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        starPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        btnplayPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        // 星星产生后消失时间的随机范围\n        maxStarDuration: 0,\n        minStarDuration: 0,\n        starDuration: 0,\n        isOver: false,\n        // 地面节点，用于确定星星生成的高度\n        ground: {\n            default: null,\n            type: cc.Node\n        },\n        // player 节点，用于获取主角弹跳的高度，和控制主角行动开关\n        player: {\n            default: null,\n            type: cc.Node\n        },\n        score: {\n            default: 0,\n            displayName: \"Score (player)\",\n            tooltip: \"The score of player\",\n        },\n\n        // score label 的引用\n        scoreDisplay: {\n            default: null,\n            type: cc.Label\n        },\n        // 跳跃音效资源\n        scoreAudio: {\n            default: null,\n            type: cc.AudioClip\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n    onLoad () {\n        console.log('hook onload');\n        // 初始化计分\n        this.score = 0;\n        this.timer = 0;\n        this.groundY = this.ground.y + this.ground.height / 2;\n        this.spawnNewStar();\n    },\n\n    start () {\n    },\n\n    update (dt) {\n        // 就会调用游戏失败逻辑\n        if (this.timer > this.starDuration) {\n            this.gameOver();\n            return;\n        }\n        this.timer += dt;\n    },\n\n    gameOver: function () {\n        if (!this.isOver) {\n            this.isOver = true;\n            this.player.stopAllActions(); //停止 player 节点的跳跃动作\n            this.player.getComponent('Player').xSpeed = 0;\n            this.showPlayBtn();\n        }\n        // cc.director.loadScene('game');\n    },\n\n    startGame () {\n        cc.director.loadScene('game');\n        this.isOver = false;\n    },\n\n    showPlayBtn () {\n        // 使用给定的模板在场景中生成一个新节点\n        var playBtn = cc.instantiate(this.btnplayPrefab);\n        // 将新增的节点添加到 Canvas 节点下面\n        this.node.addChild(playBtn);\n        // 为星星设置一个随机位置\n        playBtn.setPosition(this.getPlayBtnPosition());\n        playBtn.getComponent('Btnplay').game = this;\n    },\n\n    spawnNewStar () {\n        // 使用给定的模板在场景中生成一个新节点\n        var newStar = cc.instantiate(this.starPrefab);\n\n        // star存在时间\n        this.starDuration = this.minStarDuration + Math.random() * (this.maxStarDuration - this.minStarDuration);\n        this.timer = 0;\n\n        // 将新增的节点添加到 Canvas 节点下面\n        this.node.addChild(newStar);\n        // 为星星设置一个随机位置\n        newStar.setPosition(this.getNewStarPosition());\n        newStar.getComponent('Star').game = this;\n    },\n\n    getPlayBtnPosition () {\n        return cc.v2(0, 0);\n    },\n\n    getNewStarPosition () {\n        var randX = 0;\n        // 根据地平面位置和主角跳跃高度，随机得到一个星星的 y 坐标\n        var randY = this.groundY + Math.random() * this.player.getComponent('Player').jumpHeight + 50;\n        // 根据屏幕宽度，随机得到一个星星 x 坐标\n        var maxX = this.node.width / 2;\n        randX = (Math.random() - 0.5) * 2 * maxX;\n        // 返回星星坐标\n        return cc.v2(randX, randY);\n    },\n\n    gainScore: function () {\n        this.score += 1;\n        // 更新 scoreDisplay Label 的文字\n        this.scoreDisplay.string = 'Score: ' + this.score;\n        // 添加一个回调函数，用于在动作结束时调用我们定义的其他方法\n        cc.audioEngine.playEffect(this.scoreAudio, false);\n    },\n});\n"]}